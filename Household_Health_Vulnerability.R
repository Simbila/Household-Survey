      # Household Survey data analysis - HEALTH VULNERABILITY
      # Harmonic Biosphere Company Limited
      # Wilbert J. Simbila
      # June, 2020
      
      # Set working directory --------------------------------------------------------
      setwd("~")
      dir.create("RAP", showWarnings = FALSE)
      setwd("~/RAP")
      
      # Load/install required packageslibralies ---------------------------------------
      library(tidyverse)
      library(scales)
      library(ggrepel)
      
      
      options(scipen = 999)
      
      
      df<-read.csv("Household_Survey.csv",check.names = TRUE,stringsAsFactors = FALSE)
      
      
      # Renaming varibales
      df<-df %>% 
        rename(Respondent_Name = Respondent_.Name,
               HoH_N = HoH_.N, HM1_N = HM1_.N, HM7_G = HM6_G.1, HM8_G = HM_G)
      
      # HEAD HOUSEHOLD HEALTH VULNERABILITY ----------------------
      df_Health <- df %>% 
        select(Village,Chron_sickness, Sickness) %>% 
        filter(Chron_sickness == "Yes") %>% 
        mutate(Sickness = ifelse(str_detect(Sickness, pattern = "epilepcy")|str_detect(Sickness, pattern = "eclipsy")|str_detect(Sickness, pattern = "Epilepsy")|
                                   str_detect(Sickness, pattern = "epilepsy")|str_detect(Sickness, pattern = "eclipy")|str_detect(Sickness, pattern = "epileptic")|
                                   str_detect(Sickness, pattern = "Kifafa"),"Epilepsy", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "Mental sickness")|str_detect(Sickness, pattern = "Mental illness")|
                                   str_detect(Sickness, pattern = "Mental sickness")|str_detect(Sickness, pattern = "Has mental health issues"), "Mental Sickness", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "pressure")|str_detect(Sickness, pattern = "Heart")|str_detect(Sickness, pattern = "Pressure "), "Blood Pressure", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "aged")|str_detect(Sickness, pattern = "Old age")|
                                   str_detect(Sickness, pattern = "Aged")|str_detect(Sickness, pattern = "Aging")|str_detect(Sickness, pattern = "elderly"), "Old Age", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "Blindness")|str_detect(Sickness, pattern = "blind")|str_detect(Sickness, pattern = "Seeing")|
                                   str_detect(Sickness, pattern = "Eyesight weakness")|str_detect(Sickness, pattern = "Low vision"),"Blindness", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "rippled")|str_detect(Sickness, pattern = "Legs muscles")|str_detect(Sickness, pattern = "Fingers")|
                                   str_detect(Sickness, pattern = "back pain")|str_detect(Sickness, pattern = "Leg")|str_detect(Sickness, pattern = "legs")|
                                   str_detect(Sickness, pattern = "Weekness of born"), "Crippled", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "deaf")|str_detect(Sickness, pattern = "Deaf")|str_detect(Sickness, pattern = "Earling problems"), "Deaf", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "Dumb"), "Dumb", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "cancer"), "Cancer", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "intesti-l"), "Intestinal Problem", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "iver"), "Liver Disease", Sickness),
               Sickness = ifelse(str_detect(Sickness, pattern = "hernia"), "Hernia", Sickness))%>% 
        group_by(Village, Sickness) %>% 
        summarise(SicknessCount = n()) %>% 
        mutate(Percentages = round(SicknessCount/sum(SicknessCount)*100, digits = 2)) %>%
        view()
      
      # HEAD OF HOUSEHOLD HEALTH VULNERABILITY
      # Kisewe Head of Household Health
      df_Health %>% 
        filter(Village == "Kisewe") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Sickness))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5))+
        labs(title = "Head of Household Health Status- Kisewe Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      # Makanga Head of Household Health
      df_Health %>% 
        filter(Village == "Makanga") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Sickness))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5))+
        labs(title = "Head of Household Health Status - Makanga Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      # Mdindo Head of Household Health
      df_Health %>% 
        filter(Village == "Mdindo") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Sickness))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5))+
        labs(title = "Head of Household Health Status - Mdindo Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      # Nawenge Head of Household Health
      df_Health %>% 
        filter(Village == "Nawenge") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Sickness))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5), vjust = -15)+
        labs(title = "Head of Household Health Status - Nawenge Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      
      # FAMILY MEMBER HEALTH VULNERABILITY
      df_HealthMember <- df %>% 
        select(Village,Chron_sickness_Other_member,Handicap) %>% 
        filter(Chron_sickness_Other_member == "Yes") %>%
        mutate(Handicap = ifelse(str_detect(Handicap, pattern = "epilepcy")|str_detect(Handicap, pattern = "eclipsy")|
                                   str_detect(Handicap, pattern = "Epileptic")|str_detect(Handicap, pattern = "epilepsy")|
                                   str_detect(Handicap, pattern = "Epilepsy")|str_detect(Handicap, pattern = "Eliclpsy")|
                                   str_detect(Handicap, pattern = "His sons has being experiencing  kifafa")|str_detect(Handicap, pattern = "Seizures seaso-lly " ),"Epilepsy",Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "Mental sickness")|str_detect(Handicap, pattern = "Madness ")|
                                   str_detect(Handicap, pattern = "Craziness")|str_detect(Handicap, pattern = "Kaka yake ha- akili vizuri")|
                                   str_detect(Handicap, pattern = "Mentally ill daughter. "), "Mental Sicknes", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "Blood pressure")|str_detect(Handicap, pattern = "Wife has heart problem ")|
                                   str_detect(Handicap, pattern = "Stroke"), "Blood Pressure", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "rippled")|str_detect(Handicap, pattern = "Their daughter  has health issue problems")|
                                   str_detect(Handicap, pattern = "shorter than normal")|str_detect(Handicap, pattern = "Wife with weak legs")|
                                   str_detect(Handicap, pattern = "He fall down ")|str_detect(Handicap, pattern = "Legs illness")|
                                   str_detect(Handicap, pattern = "Handicaped hand,"), "Crippled", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "Blindness ")|str_detect(Handicap, pattern = "blind")|
                                   str_detect(Handicap, pattern = "Short sightness"), "Blindness", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "Old aged" ), "Old Age", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "dumb"), "Dumb", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "flaria"), "Flaria", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "sicklecell"), "Sickle Cell", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "cancerous."), "Cancer", Handicap),
               Handicap = ifelse(str_detect(Handicap, pattern = "Skin infection "), "Skin Infection", Handicap)) %>% 
        group_by(Village, Handicap) %>% 
        summarise(HandicapCount = n()) %>% 
        mutate(Percentages = round(HandicapCount/sum(HandicapCount)*100, digits = 2)) %>% 
        view()
      
      
      
      # Kisewe Health
      df_HealthMember %>% 
        filter(Village == "Kisewe") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Handicap))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5))+
        labs(title = "Family Members Health Status - Kisewe Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      
      # Makanga Health
      df_HealthMember %>% 
        filter(Village == "Makanga") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Handicap))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5))+
        labs(title = "Family Members Health Status - Makanga Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      # Mdindo Health
      df_HealthMember %>% 
        filter(Village == "Mdindo") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Handicap))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5))+
        labs(title = "Family Members Health Status - Mdindo Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      # Nawenge Health
      df_HealthMember %>% 
        filter(Village == "Nawenge") %>% 
        ggplot(aes(x = "", y = Percentages, fill = Handicap))+
        geom_bar(stat = "identity")+
        coord_polar("y", start = 0)+
        geom_text(aes(label = str_c(Percentages, "%")), position = position_stack(vjust = 0.5), vjust = -15)+
        labs(title = "Family Members Health Status - Nawenge Village", caption = "HBCL RAP 2020", fill = "Chronic Sickness")+
        theme_void()+
        theme(plot.title = element_text(size = 15, vjust = -8, hjust = 0.5, face = "bold"))+
        theme(plot.caption = element_text(size = 5, vjust = 25, hjust = 0.5))+
        theme(legend.title = element_text(face = "bold"))
      
      
